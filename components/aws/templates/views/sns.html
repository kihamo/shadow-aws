{{ define "content" }}
<div class="page-title">
    <div class="title_left">
        <h3>Amazon Simple Notification Service</h3>
    </div>
</div>

<div class="clearfix"></div>

<div class="x_panel">
    <div class="x_title">
        <h2><i class="fa fa-users"></i> Services</h2>
        <ul class="nav navbar-right panel_toolbox">
            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
        </ul>
        <div class="clearfix"></div>
    </div>
    <div class="x_content">
        <table class="table table-striped datatable">
            <thead>
            <tr>
                <th>Active services</th>
            </tr>
            </thead>
            <tbody>
            {{ range $name, $service := .services }}
            <tr>
                <td>{{ $name }}</td>
            </tr>
            {{ end }}
            </tbody>
        </table>
    </div>
</div>

<div class="x_panel">
    <div class="x_title">
        <h2><i class="fa fa-users"></i> Applications</h2>
        <ul class="nav navbar-right panel_toolbox">
            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                <ul class="dropdown-menu" role="menu">
                    <li>
                        <a href="javascript:void(0)" id="applications-update" data-updater="applications">
                            <i class="glyphicon glyphicon-refresh"></i> Update
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="clearfix"></div>
    </div>
    <div class="x_content">
        <table class="table table-hover table-striped datatable">
            <thead>
            <th>#</th>
            <th>IAM</th>
            <th>Application ARN</th>
            <th>Certificate expiration</th>
            <th>Endpoints</th>
            <th>Last update</th>
            </thead>
            <tbody>
            {{ range $i, $application := .applications }}
            <tr {{if not $application.Enabled}}class="danger"{{end}}>
                <td>{{ add $i 1 }}</td>
                <td class="text-center">
                    {{ if $application.IsIAM }}
                    <span class="glyphicon glyphicon-ok" style="color: #5cb85c"></span>
                    {{ else }}
                    <span class="glyphicon glyphicon-remove" style="color: #d9534f"></span>
                    {{ end }}
                </td>
                <td>{{ $application.Arn }}</td>
                <td>
                    {{ if $application.CertificateExpirationDate }}
                    {{ $application.CertificateExpirationDate }}
                    {{ else }}
                    &mdash;
                    {{ end }}
                </td>
                <td>
                    <div class="progress">
                        <div class="progress-bar progress-bar-success" style="min-width:2em;width:{{ $application.GetEnabledPercent }}%">
                            {{ $application.GetEnabledCount }}
                        </div>
                        <div class="progress-bar progress-bar-warning" style="min-width:2em;width:{{ $application.GetDisabledPercent }}%">
                            {{ $application.GetDisabledCount }}
                        </div>
                    </div>
                </td>
                <td>{{ $application.LastUpdate }}</td>
            </tr>
            {{ end }}
            </tbody>
        </table>
    </div>
</div>

<div class="x_panel">
    <div class="x_title">
        <h2><i class="fa fa-users"></i> Topics</h2>
        <ul class="nav navbar-right panel_toolbox">
            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                <ul class="dropdown-menu" role="menu">
                    <li>
                        <a href="javascript:void(0)" id="topics-update" data-updater="topics">
                            <i class="glyphicon glyphicon-refresh"></i> Update
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="clearfix"></div>
    </div>
    <div class="x_content">
        <table class="table table-striped datatable datatable-counter">
            <thead>
            <tr>
                <th></th>
                <th>Topic ARN</th>
            </tr>
            </thead>
            <tbody>
            {{ range $i, $topic := .topics }}
            <tr>
                <td>{{ add $i 1 }}</td>
                <td>{{ $topic.TopicArn }}</td>
            </tr>
            {{ end }}
            </tbody>
        </table>
    </div>
</div>

<div class="x_panel">
    <div class="x_title">
        <h2><i class="fa fa-users"></i> Subscriptions</h2>
        <ul class="nav navbar-right panel_toolbox">
            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                <ul class="dropdown-menu" role="menu">
                    <li>
                        <a href="javascript:void(0)" id="subscriptions-update" data-updater="subscriptions">
                            <i class="glyphicon glyphicon-refresh"></i> Update
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="clearfix"></div>
    </div>
    <div class="x_content">
        <table class="table table-striped datatable datatable-counter">
            <thead>
                <th></th>
                <th>Subscription ARN</th>
                <th>Endpoint</th>
            </thead>
            <tbody>
            {{ range $i, $subscription := .subscriptions }}
            <tr>
                <td>{{ add $i 1 }}</td>
                <td>{{ $subscription.SubscriptionArn }}</td>
                <td>{{ $subscription.Endpoint }}</td>
            </tr>
            {{ end }}
            </tbody>
        </table>
    </div>
</div>
{{ end }}

{{ define "head" }}
<link href="/dashboard/assets/vendors/datatables.net-bs/css/dataTables.bootstrap.min.css?v={{ .Application.build }}" rel="stylesheet">
<link href="/dashboard/assets/vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css?v={{ .Application.build }}" rel="stylesheet">
{{ end }}

{{ define "js" }}
<script src="/dashboard/assets/vendors/datatables.net/js/jquery.dataTables.min.js?v={{ .Application.build }}"></script>
<script src="/dashboard/assets/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js?v={{ .Application.build }}"></script>
<script src="/dashboard/assets/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js?v={{ .Application.build }}"></script>

<script type="application/javascript">
    $(document).ready(function () {
        $('#applications-update,#topics-update,#subscriptions-update').click(function(){
            $.post('#', {'updater': $(this).data('updater')}, function() {
                window.location.reload();
            });

            return false;
        });
    });
</script>
{{ end }}